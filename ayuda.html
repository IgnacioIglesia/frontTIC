<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ayuda ‚Äî La Otra Tribuna</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="icon" type="image/png" href="./assets/imagen.png" />
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header id="siteHeader">
    <div class="top container">
      <div class="brand-wrap">
        <a href="index.html" class="logo-link" aria-label="Ir al inicio">
          <img class="logo" src="./assets/imagen.png" alt="La Otra Tribuna">
        </a>
      </div>

      <div class="search">
        <input type="search" placeholder="Buscar club o pa√≠s‚Ä¶" autocomplete="off" />
      </div>

      <div class="header-messages" id="headerMessage">Estamos para ayudarte</div>

      <div class="actions">
        <a href="login.html" class="btn-login">Iniciar sesi√≥n</a>
        <button class="pill" aria-label="Abrir favoritos">‚ù§Ô∏è<span>0</span></button>
        <button class="pill" aria-label="Abrir carrito">üõí <span>0</span></button>
      </div>
    </div>

    <nav class="subnav">
      <div class="container subnav-inner">
        <div class="subnav-left">
          <a href="#ubicacion" class="loc-link" id="openLocation">
            <svg class="loc-ic" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 22s7-6.46 7-12a7 7 0 1 0-14 0c0 5.54 7 12 7 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="10" r="2.5" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            <span class="loc-line" id="locText">Ingresa tu <strong>ubicaci√≥n</strong></span>
          </a>
        </div>

        <div class="subnav-center">
          <a href="index.html#categorias" class="subnav-link">Categor√≠as</a>
          <a href="index.html#ofertas" class="subnav-link">Ofertas</a>
          <a href="index.html#cupones" class="subnav-link">Cupones</a>
          <a href="index.html#vender" class="subnav-link">Vender</a>
          <a href="rastrear.html" class="subnav-link">Rastrear Pedido</a>
        </div>

        <div class="subnav-right">
          <a href="ayuda.html" class="subnav-link" style="color:var(--brand);">Ayuda</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Overlay + modal ubicaci√≥n -->
  <div id="overlay" class="overlay"></div>
  <div id="locationModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Elige d√≥nde recibir tus compras</h3>
        <button class="modal-close" id="closeLocation" aria-label="Cerrar">‚úï</button>
      </div>
      <form id="locForm" class="loc-form" autocomplete="off">
        <div class="field">
          <label for="departamento">Departamento</label>
          <select id="departamento" required>
            <option value="" selected>Elija una opci√≥n</option>
          </select>
        </div>
        <div class="field">
          <label for="localidad">Localidad</label>
          <select id="localidad" required disabled>
            <option value="" selected>Elija una opci√≥n</option>
          </select>
        </div>
        <div class="actions-row">
          <button type="button" class="btn" id="cancelLoc">Cancelar</button>
          <button type="submit" class="btn primary" id="acceptLoc" disabled>Aceptar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== CONTENIDO ===== -->
  <main class="track-full">
    <div class="track-card">
      <div class="track-title">
        <img src="./assets/imagen.png" alt="" style="width:28px;height:28px;border-radius:6px;">
        <h2 style="margin:0;font-size:18px">Ayuda</h2>
      </div>

      <form id="helpForm" class="track-form">
        <!-- Email primero -->
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="Tu email" required>
        </div>

        <!-- N¬∞ pedido opcional -->
        <div class="field">
          <label for="order">N.¬∫ de pedido (opcional)</label>
          <input id="order" type="text" placeholder="Ej: ABC123456UY">
        </div>

        <!-- Descripci√≥n -->
        <div class="field">
          <label for="message">¬øQu√© ocurri√≥?</label>
          <textarea id="message" placeholder="Contanos el problema con el mayor detalle posible‚Ä¶" required></textarea>
        </div>

        <button class="btn primary" type="submit">Enviar</button>
      </form>

      <div id="helpResult" class="track-result" style="display:none"></div>
    </div>
  </main>

  <script>
    // Fija el texto del mensaje del header
    document.getElementById('headerMessage').textContent = 'Estamos para ayudarte';

    // ===== Ubicaci√≥n (mismo storage que index/rastrear) =====
    const LOCATION_KEY = 'lot_location';
    const overlay = document.getElementById('overlay');
    const openLocationBtn = document.getElementById('openLocation');
    const locationModal = document.getElementById('locationModal');
    const closeLocationBtn = document.getElementById('closeLocation');
    const cancelLocBtn = document.getElementById('cancelLoc');
    const deptSel = document.getElementById('departamento');
    const locSel = document.getElementById('localidad');
    const acceptLocBtn = document.getElementById('acceptLoc');
    const locText = document.getElementById('locText');

    const DEPTS = { "Montevideo":["Montevideo"], "Canelones":["Canelones","Ciudad de la Costa","Las Piedras","Pando"] };

    function fillDept(){ Object.keys(DEPTS).forEach(d => deptSel.append(new Option(d,d))); }
    function renderLocationText(){
      const raw = localStorage.getItem(LOCATION_KEY);
      if(!raw){ locText.innerHTML = 'Ingresa tu <strong>ubicaci√≥n</strong>'; return; }
      try{ const {loc} = JSON.parse(raw); locText.textContent = `Enviar a ${loc}`; } catch { locText.innerHTML = 'Ingresa tu <strong>ubicaci√≥n</strong>'; }
    }
    function showOverlay(){ overlay.classList.add('show'); }
    function hideOverlay(){ overlay.classList.remove('show'); }
    function openLocation(){ locationModal.classList.add('open'); showOverlay(); }
    function closeLocation(){ locationModal.classList.remove('open'); hideOverlay(); }

    openLocationBtn.addEventListener('click', (e)=>{ e.preventDefault(); openLocation(); });
    closeLocationBtn?.addEventListener('click', closeLocation);
    cancelLocBtn?.addEventListener('click', closeLocation);
    overlay.addEventListener('click', closeLocation);

    deptSel.addEventListener('change', ()=>{
      const dept = deptSel.value;
      locSel.innerHTML = '<option value="" selected>Elija una opci√≥n</option>';
      if(!dept){ locSel.disabled = true; acceptLocBtn.disabled = true; return; }
      DEPTS[dept].forEach(loc => locSel.append(new Option(loc,loc)));
      locSel.disabled = false; acceptLocBtn.disabled = true;
    });
    locSel.addEventListener('change', ()=> acceptLocBtn.disabled = !locSel.value);
    document.getElementById('locForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!deptSel.value || !locSel.value) return;
      localStorage.setItem(LOCATION_KEY, JSON.stringify({dept:deptSel.value, loc:locSel.value}));
      renderLocationText(); closeLocation();
    });

    fillDept(); renderLocationText();

    // ===== Form Ayuda =====
    const form = document.getElementById('helpForm');
    const result = document.getElementById('helpResult');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const order = document.getElementById('order').value.trim();
      const message = document.getElementById('message').value.trim();

      // (placeholder) mostrar confirmaci√≥n
      result.style.display = 'block';
      result.innerHTML =
        `<strong>¬°Gracias!</strong> Recibimos tu consulta.<br>
         <b>Email:</b> ${email}${order ? ` ‚Ä¢ <b>Pedido:</b> ${order}` : ''}<br>
         Te respondemos a la brevedad.`;
      form.reset();
    });

    // Sombra header al hacer scroll
    const siteHeader = document.getElementById('siteHeader');
    const onScroll = ()=> siteHeader.classList.toggle('is-scrolled', window.scrollY > 0);
    onScroll(); window.addEventListener('scroll', onScroll, {passive:true});
  </script>
</body>
</html>