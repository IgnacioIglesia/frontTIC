<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Favoritos — La Otra Tribuna</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="icon" type="image/png" href="./assets/logo.png" />
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header id="siteHeader">
    <div class="top container">
      <div class="brand-wrap">
        <a href="index.html" class="logo-link" aria-label="Ir al inicio">
          <img class="logo" src="./assets/logo.png" alt="La Otra Tribuna">
        </a>
      </div>

      <div class="search">
        <input type="search" placeholder="Buscar club o país…" autocomplete="off" />
      </div>

      <div class="header-messages" id="headerMessage">Tus camisetas preferidas, en un solo lugar</div>

      <div class="actions">
        <a href="login.html" class="btn-login">Iniciar sesión</a>
      </div>
    </div>

    <!-- ===== SUBNAV ===== -->
    <nav class="subnav">
      <div class="container subnav-inner">
        <div class="subnav-left">
          <a href="#ubicacion" class="loc-link" id="openLocation">
            <svg class="loc-ic" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 22s7-6.46 7-12a7 7 0 1 0-14 0c0 5.54 7 12 7 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="10" r="2.5" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            <span class="loc-line" id="locText">Ingresa tu <strong>ubicación</strong></span>
          </a>
        </div>

        <div class="subnav-center">
          <div class="has-submenu" id="catsDrop">
            <a href="index.html" class="subnav-link" id="catsLink" aria-haspopup="true" aria-expanded="false">
              Categorías <span class="chev" aria-hidden="true">▾</span>
            </a>
            <div class="cat-submenu" id="catsMenu" role="menu" aria-label="Categorías">
                <a href="index.html?cat=club#catalogo">Club</a>
                <a href="index.html?cat=seleccion#catalogo">Selección</a>
                <a href="index.html?cat=retro#catalogo">Retro</a>
            </div>
          </div>
          <a href="ofertas.html" class="subnav-link">Ofertas</a>
          <a href="vender.html" class="subnav-link">Vender</a>
          <a href="rastrear.html" class="subnav-link">Rastrear Pedido</a>
        </div>

        <div class="subnav-right">
          <a href="favoritos.html" class="subnav-link">Favoritos</a>
          <a href="como-funciona.html" class="subnav-link">Cómo funciona</a>
          <a href="autenticidad.html" class="subnav-link">Autenticidad</a>
          <a href="ayuda.html" class="subnav-link">Ayuda</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- ===== Overlay + MODAL UBICACIÓN (faltaban en tu archivo) ===== -->
  <div id="overlay" class="overlay"></div>
  <div id="locationModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Elige dónde recibir tus compras</h3>
        <button class="modal-close" id="closeLocation" aria-label="Cerrar">✕</button>
      </div>
      <form id="locForm" class="loc-form" autocomplete="off">
        <div class="field">
          <label for="departamento">Departamento</label>
          <select id="departamento" required>
            <option value="" selected>Elija una opción</option>
          </select>
        </div>
        <div class="field">
          <label for="localidad">Localidad</label>
          <select id="localidad" required disabled>
            <option value="" selected>Elija una opción</option>
          </select>
        </div>
        <div class="actions-row">
          <button type="button" class="btn" id="cancelLoc">Cancelar</button>
          <button type="submit" class="btn primary" id="acceptLoc" disabled>Aceptar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== CONTENIDO ===== -->
  <main class="container">
    <div class="info-wrap" style="padding:20px">
      <h1 style="margin-bottom:6px">Favoritos</h1>
      <p class="lead">Guardá tus camisetas preferidas y comparalas fácil. Podés pasarlas al carrito cuando quieras.</p>

      <div id="favGrid" class="favs-grid" style="margin-top:12px"></div>
      <p id="favEmpty" class="muted" style="text-align:center; display:none; margin:18px 0">
        Aún no agregaste favoritos.
      </p>
    </div>
  </main>

  <script>
    // ===== Mensaje header =====
    document.getElementById('headerMessage').textContent = 'Tus camisetas preferidas, en un solo lugar';

    // ====== DEMO DATA (si entran directo a esta página) ======
    const DATA = [
      {id:1,nombre:'Camiseta Local 24/25',club:'Barcelona',pais:'España',categoria:'Club',precio:3290,img:'./assets/camisetas/barcelona-local.jpg'},
      {id:2,nombre:'Camiseta Visitante 24/25',club:'Barcelona',pais:'España',categoria:'Club',precio:3190,img:'./assets/camisetas/barcelona-visitante.jpg'},
      {id:3,nombre:'Camiseta Titular 24/25',club:'Real Madrid',pais:'España',categoria:'Club',precio:3490,img:'./assets/camisetas/real-madrid-titular.jpg'},
      {id:4,nombre:'Camiseta Selección 24/25',club:'Uruguay',pais:'Uruguay',categoria:'Selección',precio:2990,img:'./assets/camisetas/uruguay-seleccion.jpg'}
    ];
    const PLACEHOLDER = 'https://placehold.co/600x750?text=Camiseta';
    const uy = new Intl.NumberFormat('es-UY',{style:'currency',currency:'UYU',maximumFractionDigits:0});

    // ====== FAVORITOS ======
    const favorites = new Set(JSON.parse(localStorage.getItem('lot_favorites') || '[]'));
    const grid = document.getElementById('favGrid');
    const empty = document.getElementById('favEmpty');
    function saveFavorites(){ localStorage.setItem('lot_favorites', JSON.stringify([...favorites])); }

    function renderFavs(){
      grid.innerHTML = '';
      if(!favorites.size){ empty.style.display='block'; return; }
      empty.style.display='none';

      DATA.filter(p=>favorites.has(p.id)).forEach(p=>{
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="media">
            <img src="${p.img}" alt="${p.nombre}" onerror="this.src='${PLACEHOLDER}'">
          </div>
          <div class="body">
            <div class="meta">
              <div>
                <div style="font-weight:700">${p.nombre}</div>
                <div class="muted">${p.club} • ${p.categoria}</div>
              </div>
              <div class="price">${uy.format(p.precio)}</div>
            </div>
            <div style="display:flex; gap:8px">
              <button class="btn primary" data-act="cart" data-id="${p.id}">Agregar al carrito</button>
              <button class="btn ghost" data-act="rm" data-id="${p.id}">Quitar</button>
            </div>
          </div>`;
        grid.appendChild(card);
      });
    }

    // carrito demo en localStorage
    function addCart(id){
      const key = 'lot_cart_demo';
      const cart = new Map(Object.entries(JSON.parse(localStorage.getItem(key) || '{}')).map(([k,v])=>[+k,v]));
      const prod = DATA.find(x=>x.id===id); if(!prod) return;
      cart.set(id, (cart.get(id)||0)+1);
      localStorage.setItem(key, JSON.stringify(Object.fromEntries(cart)));
      alert('Agregado al carrito (demo)');
    }

    grid.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-act]'); if(!btn) return;
      const id = Number(btn.dataset.id);
      if(btn.dataset.act==='rm'){ favorites.delete(id); saveFavorites(); renderFavs(); }
      if(btn.dataset.act==='cart'){ addCart(id); }
    });

    renderFavs();

    // ====== UBICACIÓN (mismo código que en Ayuda) ======
    const LOCATION_KEY = 'lot_location';
    const overlay = document.getElementById('overlay');
    const openLocationBtn = document.getElementById('openLocation');
    const locationModal = document.getElementById('locationModal');
    const closeLocationBtn = document.getElementById('closeLocation');
    const cancelLocBtn = document.getElementById('cancelLoc');
    const deptSel = document.getElementById('departamento');
    const locSel = document.getElementById('localidad');
    const acceptLocBtn = document.getElementById('acceptLoc');
    const locText = document.getElementById('locText');

    const DEPTS = {
      "Artigas":["Artigas","Bella Unión","Tomás Gomensoro","Baltasar Brum"],
      "Canelones":["Canelones","Ciudad de la Costa","Las Piedras","Pando","La Paz","Progreso","Santa Lucía","Atlántida","Parque del Plata","Sauce","San Ramón","Empalme Olmos","Toledo"],
      "Cerro Largo":["Melo","Río Branco","Fraile Muerto","Tupambaé","Isidoro Noblía"],
      "Colonia":["Colonia del Sacramento","Carmelo","Nueva Helvecia","Juan Lacaze","Rosario","Tarariras","Ombúes de Lavalle"],
      "Durazno":["Durazno","Sarandí del Yí","Carmen","Centenario"],
      "Flores":["Trinidad","Ismael Cortinas"],
      "Florida":["Florida","Sarandí Grande","Casupá","25 de Mayo"],
      "Lavalleja":["Minas","José Pedro Varela","Solís de Mataojo","Mariscala"],
      "Maldonado":["Maldonado","Punta del Este","San Carlos","Piriápolis","Pan de Azúcar","Aiguá","La Barra"],
      "Montevideo":["Montevideo"],
      "Paysandú":["Paysandú","Guichón","Quebracho","Piedras Coloradas"],
      "Río Negro":["Fray Bentos","Young","Nuevo Berlín","San Javier"],
      "Rivera":["Rivera","Tranqueras","Minas de Corrales","Vichadero","Mandubí"],
      "Rocha":["Rocha","Chuy","Castillos","Lascano","La Paloma","Punta del Diablo"],
      "Salto":["Salto","Constitución","Belén","Daymán","San Antonio"],
      "San José":["San José de Mayo","Ciudad del Plata","Libertad","Ecilda Paullier","Delta El Tigre","Raigón"],
      "Soriano":["Mercedes","Dolores","Cardona","José Enrique Rodó","Palmitas"],
      "Tacuarembó":["Tacuarembó","Paso de los Toros","San Gregorio de Polanco","Curtina","Ansina"],
      "Treinta y Tres":["Treinta y Tres","Vergara","Santa Clara de Olimar","Villa Sara"]
    };

    function fillDept(){ Object.keys(DEPTS).forEach(d => deptSel.append(new Option(d,d))); }
    function renderLocationText(){
      const raw = localStorage.getItem(LOCATION_KEY);
      if(!raw){ locText.innerHTML = 'Ingresa tu <strong>ubicación</strong>'; return; }
      try{ const {loc} = JSON.parse(raw); locText.textContent = `Enviar a ${loc}`; }
      catch{ locText.innerHTML = 'Ingresa tu <strong>ubicación</strong>'; }
    }
    function showOverlay(){ overlay.classList.add('show'); }
    function hideOverlay(){ overlay.classList.remove('show'); }
    function openLocation(){ locationModal.classList.add('open'); showOverlay(); }
    function closeLocation(){ locationModal.classList.remove('open'); hideOverlay(); }

    openLocationBtn.addEventListener('click', (e)=>{ e.preventDefault(); openLocation(); });
    closeLocationBtn?.addEventListener('click', closeLocation);
    cancelLocBtn?.addEventListener('click', closeLocation);
    overlay.addEventListener('click', closeLocation);

    deptSel.addEventListener('change', ()=>{
      const dept = deptSel.value;
      locSel.innerHTML = '<option value="" selected>Elija una opción</option>';
      if(!dept){ locSel.disabled = true; acceptLocBtn.disabled = true; return; }
      DEPTS[dept].forEach(loc => locSel.append(new Option(loc,loc)));
      locSel.disabled = false; acceptLocBtn.disabled = true;
    });

    locSel.addEventListener('change', ()=> acceptLocBtn.disabled = !locSel.value);

    document.getElementById('locForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!deptSel.value || !locSel.value) return;
      localStorage.setItem(LOCATION_KEY, JSON.stringify({dept:deptSel.value, loc:locSel.value}));
      renderLocationText(); closeLocation();
    });

    fillDept(); renderLocationText();

    // ===== Header shadow on scroll =====
    const siteHeader = document.getElementById('siteHeader');
    const onScroll = ()=> siteHeader.classList.toggle('is-scrolled', window.scrollY > 0);
    onScroll(); window.addEventListener('scroll', onScroll, {passive:true});

    // (Opcional) submenu categorías en mobile
    const catsDrop = document.getElementById('catsDrop');
    const catsLink = document.getElementById('catsLink');
    catsLink?.addEventListener('click', (e)=>{
      if (window.matchMedia('(max-width: 820px)').matches){
        e.preventDefault();
        catsDrop.classList.toggle('open');
      }
    });
    document.addEventListener('click', (e)=>{
      if(!catsDrop.contains(e.target)) catsDrop.classList.remove('open');
    });
  </script>
</body>
</html>